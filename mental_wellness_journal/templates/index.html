<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mental Wellness Journal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='animation.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <!-- 🎵 Background Music -->
    <audio autoplay loop hidden>
        <source src="{{ url_for('static', filename='background.mp3') }}" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>

    <div class="background-animation"></div>

    <div class="container">
        <h1>🌸 Mental Wellness Journal</h1>

        <!-- ✨ Motivational Quote -->
        <div class="quote-box">💡 "{{ quote }}"</div>

        <!-- 📋 Entry Form -->
        <form action="/add" method="POST">
            <label>Mood:</label>
            <select name="mood">
                <option>Happy</option>
                <option>Sad</option>
                <option>Angry</option>
                <option>Anxious</option>
                <option>Tired</option>
            </select>

            <label>Activity Today:</label>
            <input type="text" name="activity" placeholder="e.g. Yoga, Reading" required>

            <label>Write your thoughts:</label>
            <textarea name="note" placeholder="What's on your mind?" required></textarea>

            <button type="submit">Save Entry</button>
        </form>

        <!-- 📊 Mood Graph -->
        <h2>🧠 Mood Analysis</h2>
        <div class="chart-container">
            <canvas id="moodChart"></canvas>
        </div>

        <!-- 🖼️ Mood Image -->
        <h2>📷 Mood Visual</h2>
        <img src="{{ url_for('static', filename=mood_image) }}" class="mood-image">

        <!-- 📁 Export Button -->
        <div class="export-link">
            <a href="/export" class="btn-export">⬇️ Export Journal to CSV</a>
        </div>

        <!-- 📓 Journal Entries -->
        <h2>📚 Your Entries</h2>
        <ul>
            {% for entry in entries %}
                <li>
                    <strong>{{ entry[1][:16] }}</strong> — <span class="mood">{{ entry[2] }}</span><br>
                    <em>Activity: {{ entry[3] }}</em><br>
                    {{ entry[4] }}
                </li>
            {% endfor %}
        </ul>
    </div>

    <!-- 📈 Chart JS -->
    <script>
        const moodCounts = {{ mood_counts | tojson }};
        const labels = Object.keys(moodCounts);
        const data = Object.values(moodCounts);

        const ctx = document.getElementById('moodChart').getContext('2d');
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Mood Frequency',
                    data: data,
                    backgroundColor: ['#ffb3ba', '#bae1ff', '#baffc9', '#ffffba', '#d5baff']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    </script>

</body>
</html>
